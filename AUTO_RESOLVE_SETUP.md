# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç—Ä–∏–∫ –∞–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–π –∏ SLA

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –¢–∞–±–ª–∏—Ü–∞ `chat_interactions`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç: –±—ã–ª –ª–∏ —Å–æ–∑–¥–∞–Ω —Ç–∏–∫–µ—Ç, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- **–ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–µ = `ticket_created = FALSE`** (–ò–ò –æ—Ç–≤–µ—Ç–∏–ª –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞)

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –ö–∞–∂–¥–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- –ò–∑–º–µ—Ä—è–µ—Ç—Å—è –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (`response_time_ms`)
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏—è —Å—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ `chat_interactions` + `tickets`
- SLA —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ –ò–ò
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –µ–¥–∏–Ω—ã–π –æ—Ç—á–µ—Ç

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

–í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
-- –§–∞–π–ª: supabase/migrations/010_add_chat_interactions_table.sql
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend

```bash
cd backend
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)
uvicorn main:app --reload
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø—É–±–ª–∏—á–Ω—ã–π —á–∞—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   [CHAT_INTERACTION] Saved interaction: ticket_created=False, response_time=1234ms, ticket_id=None
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase:
   ```sql
   SELECT * FROM chat_interactions ORDER BY created_at DESC LIMIT 5;
   ```

## üìä –§–æ—Ä–º—É–ª—ã –º–µ—Ç—Ä–∏–∫

### –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–µ

```
–ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–µ (%) = (–ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏—è / –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤) * 100

–ì–¥–µ:
- –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏—è = COUNT(*) WHERE ticket_created = FALSE (–∏–∑ chat_interactions)
                + COUNT(*) WHERE auto_resolved = TRUE (–∏–∑ tickets)
- –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ = COUNT(*) (–∏–∑ chat_interactions) + COUNT(*) (–∏–∑ tickets)
```

### SLA —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

```
SLA —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ (%) = (–û—Ç–≤–µ—Ç—ã < –ø–æ—Ä–æ–≥–∞ / –í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤) * 100

–ì–¥–µ:
- –ü–æ—Ä–æ–≥ = 5000ms (5 —Å–µ–∫—É–Ω–¥) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ = response_time_ms –∏–∑ chat_interactions
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

### –ß–µ—Ä–µ–∑ API

```bash
GET /api/admin/monitoring/metrics?from_date=2024-01-01&to_date=2024-12-31
```

–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç:
```json
{
  "auto_resolve_stats": {
    "total_auto_resolved": 150,      // –í—Å–µ–≥–æ –∞–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–π
    "total_tickets": 200,             // –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è + —Ç–∏–∫–µ—Ç—ã)
    "auto_resolve_rate": 75.0,        // –ü—Ä–æ—Ü–µ–Ω—Ç –∞–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–π
    "avg_confidence": 0.85,           // –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    "by_category": {...}              // –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  },
  "response_time_stats": {
    "avg_response_time_seconds": 2.5, // –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
    "median_response_time_seconds": 2.1,
    "p95_response_time_seconds": 4.8
  }
}
```

### –ß–µ—Ä–µ–∑ SQL

```sql
-- –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
SELECT 
    DATE(created_at) as date,
    COUNT(*) FILTER (WHERE ticket_created = FALSE) as auto_resolved,
    COUNT(*) as total,
    ROUND(COUNT(*) FILTER (WHERE ticket_created = FALSE)::FLOAT / COUNT(*) * 100, 2) as rate
FROM chat_interactions
WHERE created_at >= NOW() - INTERVAL '7 days'
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

## üìà –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–µ

- **> 70%** - –û—Ç–ª–∏—á–Ω–æ! –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ —Ä–µ—à–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **50-70%** - –•–æ—Ä–æ—à–æ, –Ω–æ –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
- **30-50%** - –°—Ä–µ–¥–Ω–µ, –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
- **< 30%** - –ü–ª–æ—Ö–æ, –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ —Ç—Ä–µ–±—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–æ–≤

### SLA —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

- **> 95%** - –û—Ç–ª–∏—á–Ω–æ! –ü–æ—á—Ç–∏ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö SLA
- **80-95%** - –•–æ—Ä–æ—à–æ
- **60-80%** - –°—Ä–µ–¥–Ω–µ, –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
- **< 60%** - –ü–ª–æ—Ö–æ, –º–Ω–æ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π SLA

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Ç—Ä–µ–Ω–¥—ã –∞–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–π –ø–æ –¥–Ω—è–º/–Ω–µ–¥–µ–ª—è–º
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –Ω–∏–∑–∫–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º –∞–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–π
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (response_time > 5s)

2. **–£–ª—É—á—à–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:**
   - –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–µ < 50%, –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
   - –ò–Ω–¥–µ–∫—Å–∏—Ä—É–π—Ç–µ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã
   - –û–±–Ω–æ–≤–ª—è–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Ä–µ–≥—É–ª—è—Ä–Ω–æ

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
   - –ï—Å–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ > 3s, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
     - –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase
     - –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAI
     - –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤)

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–µ ‚â† –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–Ω—ã–π —Ç–∏–∫–µ—Ç**
   - –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏–µ = –ò–ò –æ—Ç–≤–µ—Ç–∏–ª –ë–ï–ó —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞
   - –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–Ω—ã–π —Ç–∏–∫–µ—Ç = –¢–∏–∫–µ—Ç –±—ã–ª —Å–æ–∑–¥–∞–Ω, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ—à–µ–Ω

2. **–î–≤–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã:**
   - –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏—è –∏–∑ `chat_interactions` (–ø—É–±–ª–∏—á–Ω—ã–π —á–∞—Ç)
   - –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏—è –∏–∑ `tickets` (–¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
   - –û–±—â–∞—è –º–µ—Ç—Ä–∏–∫–∞ = —Å—É–º–º–∞ –æ–±–æ–∏—Ö

3. **Session ID:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏–∑ frontend –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç:
- ‚úÖ –ê–≤—Ç–æ—Ä–µ—à–µ–Ω–∏—è (–∫–æ–≥–¥–∞ –ò–ò –æ—Ç–≤–µ—Ç–∏–ª –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–∫–µ—Ç–∞)
- ‚úÖ SLA —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ (–≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –ò–ò)
- ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ API

